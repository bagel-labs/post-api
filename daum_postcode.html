<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>주소 검색</title>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box;
        }
        html, body { 
            width: 100%; 
            height: 100%; 
            overflow: hidden; 
            background: white;
        }
        #layer {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="layer"></div>
    <script src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        // Daum 우편번호 서비스 초기화
        new daum.Postcode({
            oncomplete: function(data) {
                var addr = data.address;
                var zonecode = data.zonecode;
                
                // 지번 주소를 포함하는 경우
                if(data.addressType === 'R'){
                    // 법정동명이 있을 경우 추가
                    if(data.bname !== '' && /[동|로|가]$/.test(data.bname)){
                        addr += ' ' + data.bname;
                    }
                    // 건물명이 있고, 공동주택일 경우 추가
                    if(data.buildingName !== '' && data.apartment === 'Y'){
                        addr += (addr !== '' ? ', ' + data.buildingName : data.buildingName);
                    }
                }
                
                // Android JavaScript Interface 호출
                if (typeof Android !== 'undefined' && Android.processDATA) {
                    Android.processDATA(zonecode, addr);
                } else {
                    console.error('Android interface not found');
                }
            },
            width: '100%',
            height: '100%',
            maxSuggestItems: 5
        }).embed(document.getElementById('layer'));
        
        // 페이지 로드 후 링크 가로채기
        window.addEventListener('load', function() {
            function interceptLinks() {
                var allLinks = document.querySelectorAll('a[href]');
                console.log('[DEBUG] 총 링크 개수:', allLinks.length);
                allLinks.forEach(function(link, index) {
                    var href = link.getAttribute('href');
                    if (!href) return;
                    
                    // 텍스트 정규화 (공백 제거, 소문자 변환)
                    var normalizedText = link.textContent.replace(/\s+/g, '').toLowerCase();
                    var normalizedHref = href.toLowerCase();
                    var linkText = link.innerText || link.textContent || '';
                    
                    // FAQ 링크 처리 - 더 유연한 매칭
                    var isFaqLink = false;
                    var faqCheckReason = '';
                    
                    // href로 확인 (QnA, FAQ 등) - 소문자로 변환된 href에서 체크
                    if (normalizedHref.indexOf('faq') !== -1) {
                        isFaqLink = true;
                        faqCheckReason = 'href에 faq 포함';
                    } else if (normalizedHref.indexOf('qna') !== -1) {
                        isFaqLink = true;
                        faqCheckReason = 'href에 qna 포함';
                    } else if (normalizedHref.indexOf('github.com') !== -1 && normalizedHref.indexOf('qna') !== -1) {
                        isFaqLink = true;
                        faqCheckReason = 'github.com + qna';
                    } else if (normalizedHref.indexOf('daumpostcode/qna') !== -1) {
                        isFaqLink = true;
                        faqCheckReason = 'daumpostcode/qna';
                    }
                    
                    // 텍스트로 확인 (정규식 사용 - 공백, 괄호 등 무시)
                    if (!isFaqLink && linkText) {
                        // "자주 묻는 질문", "자주묻는질문", "자주 묻는 질문(FAQ)" 등 모두 매칭
                        // 공백을 제거한 텍스트로도 확인
                        var textWithoutSpaces = linkText.replace(/\s+/g, '');
                        var lowerText = linkText.toLowerCase();
                        
                        // 정규식: 자주 + (공백) + 묻는 + (공백) + 질문 또는 FAQ
                        var faqPattern = /자주\s*묻는\s*질문|자주묻는질문|faq/i;
                        
                        if (faqPattern.test(linkText)) {
                            isFaqLink = true;
                            faqCheckReason = '정규식 매칭 (linkText)';
                        } else if (faqPattern.test(textWithoutSpaces)) {
                            isFaqLink = true;
                            faqCheckReason = '정규식 매칭 (textWithoutSpaces)';
                        } else if (textWithoutSpaces.indexOf('자주묻는질문') !== -1) {
                            isFaqLink = true;
                            faqCheckReason = 'textWithoutSpaces에 자주묻는질문';
                        } else if (lowerText.indexOf('faq') !== -1) {
                            isFaqLink = true;
                            faqCheckReason = 'lowerText에 faq';
                        } else if (lowerText.indexOf('자주 묻는 질문') !== -1) {
                            isFaqLink = true;
                            faqCheckReason = 'lowerText에 자주 묻는 질문';
                        }
                    }
                    
                    // 디버깅 로그
                    console.log('[DEBUG] 링크 #' + index + ':', {
                        href: href,
                        normalizedHref: normalizedHref,
                        linkText: linkText,
                        textWithoutSpaces: linkText ? linkText.replace(/\s+/g, '') : '',
                        lowerText: linkText ? linkText.toLowerCase() : '',
                        isFaqLink: isFaqLink,
                        reason: faqCheckReason || 'FAQ 아님'
                    });
                    
                    if (isFaqLink) {
                        // href를 제거하여 기본 링크 동작 방지
                        link.setAttribute('href', '#');
                        link.setAttribute('data-original-href', href); // 원본 저장 (필요시)
                        
                        // 여러 방식으로 이벤트 차단
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            e.stopImmediatePropagation();
                            return false;
                        }, true); // capture 모드로 먼저 실행
                        
                        // Android Interface로 FAQ 클릭 알림
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (typeof Android !== 'undefined' && Android.onLinkClick) {
                                Android.onLinkClick('faq');
                            }
                            return false;
                        }, false);
                        
                        // 마우스 이벤트도 차단
                        link.onclick = function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            if (typeof Android !== 'undefined' && Android.onLinkClick) {
                                Android.onLinkClick('faq');
                            }
                            return false;
                        };
                    }
                    // 카카오맵 링크 처리
                    else if (href.indexOf('map.kakao') !== -1 || href.indexOf('kakao.com') !== -1 || 
                             link.textContent.indexOf('지도') !== -1 || link.textContent.indexOf('맵') !== -1 ||
                             href.indexOf('place') !== -1) {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            e.stopPropagation();
                            // Android Interface로 카카오맵 링크 전달
                            if (typeof Android !== 'undefined' && Android.onLinkClick) {
                                Android.onLinkClick('map', href);
                            }
                        }, true);
                    }
                });
            }
            
            // MutationObserver로 동적으로 추가되는 링크 감지
            var observer = new MutationObserver(function(mutations) {
                interceptLinks();
            });
            
            // body 전체를 관찰
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            // 초기 실행 (이미 존재하는 링크 처리)
            setTimeout(interceptLinks, 500);
            setTimeout(interceptLinks, 1500);
        });
    </script>
</body>
</html>

